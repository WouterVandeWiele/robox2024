<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" content="#2a3140">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2.0.6/css/pico.min.css">
  <!-- <script src="https://unpkg.com/htmx.org@2.0.1" ></script> -->
  <title>Robox 2024</title>

</head>
<body>
  <!-- Navigation -->

  <header class="container">
    <nav>
      <a aria-label="Robox homepage" data-discover="true" href="/">
          <img src="static/robox-logo2.svg" alt="Logo" style="width:100%; max-width:200px;">
      </a>
      <h1>
        <mark style="background: linear-gradient(to right, #d78dd2, #b999ee, #9da5e9, #8fa9f0); -webkit-background-clip: text; background-clip: text; color: transparent;">Robox 2024 Project</mark>
      </h1>
      <ul class="icons">
        <li>
          <details class="dropdown">
            <summary role="button" class="secondary">Theme</summary>
            <ul>
              <li><a href="#" data-theme-switcher="auto">Auto</a></li>
              <li><a href="#" data-theme-switcher="light">Light</a></li>
              <li><a href="#" data-theme-switcher="dark">Dark</a></li>
            </ul>
          </details>
        </li>
        <li>
          <a rel="noopener noreferrer" class="contrast" aria-label="GitHub repository" href="https://github.com/WouterVandeWiele/robox2024" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" height="24" width="24.25" viewBox="0 0 496 512" class="icon-github"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a>
        </li>
      </ul>
    </nav>
  </header>

  <!-- Main content -->
  <main class="container">
    <!-- <section class="examples-hero">
        <h1>
            <mark style="background: linear-gradient(to right, #d78dd2, #b999ee, #9da5e9, #8fa9f0); -webkit-background-clip: text; background-clip: text; color: transparent;">Configure Settings</mark>
        </h1>
        <p class="secondary">Minimalist templates to discover Pico in action.</p>
    </section> -->
    <section class="example-list">

        <!-- Project showcase -->
    
        <article>
            <h2>Project Showcase</h2>
            <p>...</p>
        </article>

    </section>

    <section>
      <h3>Current Releases</h3>
      <div id="rss-feed-container"></div>
    </section>
  </main>

  <!-- RSS feed render -->
  <!-- https://github.com/KuestenKeks/rss-feed-preview-js -->
  <script type = "text/javascript">

    // (this is for creating sth. like a namespace called "simpleRssFeedPreview", see https://js-tutorials.info/namespace-in-javascript/)
    var simpleRssFeedPreview = {};
    (function() {
  
      // == SETTINGS ================================================================================================================================================================================
  
      // This needs to point to your website's RSS feed. If your feed's full URL is "https://example.org/rss/blog" then "/rss/blog" is what you need to provide here.
      const setting_FeedPath = "releases.xml";
  
      // The description of your RSS feed's items will be truncated to this length.
      // (And then some more is truncated to make sure there are no sentence fragments remaining at the end of the description preview)
      const setting_MaxPreviewLength = 300;
  
      // how many items of your RSS feed should be displayed?
      // (if you provide a number that's larger than the amount of items in your feed, then only the available feed items will be displayed)
      const setting_MaxEntries = 3;
  
      // Try setting this to 'true' if your oldest RSS entries are displayed instead of the most current ones.
      // (By default the first entries contained in the RSS XML are displayed. These are usually the newest ones, but with some feeds the last entries are.)
      const setting_ReverseOrder = true;
  
      // The HTML template into which each RSS item's content will be inserted into. You might want to customize this template to fit your needs.
      const setting_HtmlTemplate = template`<h3><a href="${"link"}">${"title"} (${"pubDate"})</a></h3> <p>${"description"} âš¬ <strong><a href="${"link"}">Continue reading...</a></p></strong>`;
  
      // ============================================================================================================================================================================================
  
      const rssFeedContainer = document.getElementById("rss-feed-container");
  
      // For local testing you can upload an RSS feed as an xml file
      // needs an input element like this:
      //   <input type="file" onchange="simpleRssFeedPreview.onFileLoad()"/>
      // you may delete this function before deploying the script to your website
      // this.onFileLoad = function() {
      //   const [file] = document.querySelector('input[type=file]').files;
      //   const reader = new FileReader();
  
      //   reader.addEventListener("load", () => {
      //     createHtmlPreviewForRssFeed(reader.result);
      //   }, false);
  
      //   if (file) {
      //     reader.readAsText(file);
      //   }
      // }
  
      this.getRssByRequest = function() {
        // inspired by: https://javascript.info/xmlhttprequest
  
        // 1. Create a new XMLHttpRequest object
        let xhr = new XMLHttpRequest();
  
        // 2. GET-request for the URL path where your RSS Feed is located
        xhr.open('GET', setting_FeedPath);
  
        // 3. Send the request over the network
        xhr.send();
  
        // 4. This will be called after the response is received
        xhr.onload = function() {
          // analyze HTTP status of the response
          if (xhr.status = 200) {
            createHtmlPreviewForRssFeed(xhr.response);
          } else {
            console.error(`Error getting RSS-Feed: ${xhr.status} ${xhr.statusText}`); // e.g. 404: Not Found
          }
        };
  
        xhr.onerror = function() {
          console.error(`Error getting RSS-Feed, Request failed`);console.error
        };
      }
  
      function createHtmlPreviewForRssFeed(rssXmlText) {
        let parser = new DOMParser();
        let xmlDoc = parser.parseFromString(rssXmlText,"text/xml");
  
        let docFrag = document.createDocumentFragment();
  
        if (!setting_ReverseOrder) {
          let xPathResult = xmlDoc.evaluate("/rss/channel/item", xmlDoc, null, XPathResult.ORDERED_NODE_ITERATOR_TYPE, null);
          let node = xPathResult.iterateNext();
          for (let i = 0; (i < setting_MaxEntries) && node; i++) {
            docFrag.appendChild(createHtmlFragmentForRssItem(node));
            node = xPathResult.iterateNext();
          }
        } else {
          let xPathResult = xmlDoc.evaluate("/rss/channel/item", xmlDoc, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
          for (let i = (xPathResult.snapshotLength - 1); (i >= 0) && (i >= (xPathResult.snapshotLength - setting_MaxEntries)); i--) {
            docFrag.appendChild(createHtmlFragmentForRssItem(xPathResult.snapshotItem(i)));
          }
        }
        rssFeedContainer.appendChild(docFrag);
      }
  
      function createHtmlFragmentForRssItem(itemNode) {
        let htmlFragment = document.createElement('article');
  
        let title = itemNode.getElementsByTagName("title")[0].textContent;
        let link = itemNode.getElementsByTagName("link")[0].textContent;
  
        // Strips the description of any HTML markup and cleans it up a bit by removing unwanted whitespace.
        let description = stripHtml(itemNode.getElementsByTagName("description")[0].textContent).trim().replace(/\s+/g,' ');
  
        // to generate a shorter preview we only take the first few sentences
        // (which have to end with at least one dot, question mark or exclamation mark. But "... St." is not an accepted sentence ending because it can be part of location names, like "St. Petersburg".)
        let descriptionPreview = description.slice(0,setting_MaxPreviewLength);
        let firstSentences = descriptionPreview.match(/.*(?<!\bSt)[\.\?!]/s);
        descriptionPreview = firstSentences ?? descriptionPreview + '...'; // "firstSentences" might be null, then we'll have to live with a cut off sentence fragment
  
        let pubDate = new Date(itemNode.getElementsByTagName("pubDate")[0].textContent);
        let pubDateString =  (new Intl.DateTimeFormat('en-US', { dateStyle: 'medium' }).format(pubDate).toString());
  
        // this embeds the content of the RSS feed item into the template's HTML structure.
        htmlFragment.innerHTML = setting_HtmlTemplate({ link: link, title: title, pubDate: pubDateString, description: descriptionPreview});
  
        return htmlFragment;
      }
  
      // built upon https://www.w3docs.com/snippets/javascript/how-to-strip-html-from-a-string-in-javascript.html
      function stripHtml(html) {
        // Create a new div element
        let temporalDivEl = document.createElement("div");
        // insert HTML content
        temporalDivEl.innerHTML = html;
  
        // <script> elements can sometimes have comments. We don't want those in our text that's stripped from HTML. Hence we're removing them all.
        [temporalDivEl.getElementsByTagName("script")].forEach(element => {
          // if no tags are found we still get an HTMLCollection with length zero back, so we need to check if the first elemenent in the collection is defined
          if (element[0]) {
            element[0].remove();
          }
        });
  
        // <figure> elements can have a <figcaption> providing a caption text. We don't need those here either.
        [temporalDivEl.getElementsByTagName("figure")].forEach(element => {
          if (element[0]) {
            element[0].remove();
          }
        });
  
        // Get the text property of the element (browser support)
        return temporalDivEl.innerText || "";
      }
  
      // source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates
      function template(strings, ...keys) {
        return (...values) => {
          const dict = values[values.length - 1] || {};
          const result = [strings[0]];
          keys.forEach((key, i) => {
            const value = Number.isInteger(key) ? values[key] : dict[key];
            result.push(value, strings[i + 1]);
          });
          return result.join("");
        };
      }
  
    }).apply(simpleRssFeedPreview);
  
    // run the code!
    simpleRssFeedPreview.getRssByRequest();
  </script>
  
  <!-- Minimal theme switcher -->
  <script src="static/minimal-theme-switcher.js"></script>
</body>
</html>